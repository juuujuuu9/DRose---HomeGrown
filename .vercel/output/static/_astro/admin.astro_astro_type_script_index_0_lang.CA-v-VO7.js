function p(){return document.querySelector(".tab-btn.bg-\\[\\#ce1141\\]")?.getAttribute("data-tab")||"players"}function m(r){const o=r.toLowerCase().trim(),s=document.getElementById("entries-tbody");if(s){const n=Array.from(s.querySelectorAll("tr"));o.length<2?n.forEach(t=>{t.style.display=""}):n.forEach(t=>{const a=t.getAttribute("data-first-name")||"",c=t.querySelector("td:nth-child(2)")?.textContent?.toLowerCase()||"",l=t.querySelector("td:nth-child(3)")?.textContent?.toLowerCase()||"",i=t.querySelector("td:nth-child(4)")?.textContent?.toLowerCase()||"",d=t.querySelector("td:nth-child(5)")?.textContent?.toLowerCase()||"",y=t.querySelector("td:nth-child(6)")?.textContent?.toLowerCase()||"",f=a.includes(o)||c.includes(o)||l.includes(o)||i.includes(o)||d.includes(o)||y.includes(o);t.style.display=f?"":"none"})}const e=document.getElementById("non-player-entries-tbody");if(e){const n=Array.from(e.querySelectorAll("tr"));o.length<2?n.forEach(t=>{t.style.display=""}):n.forEach(t=>{const a=t.getAttribute("data-first-name")||"",c=t.querySelector("td:nth-child(1)")?.textContent?.toLowerCase()||"",l=t.querySelector("td:nth-child(2)")?.textContent?.toLowerCase()||"",i=t.querySelector("td:nth-child(3)")?.textContent?.toLowerCase()||"",d=t.querySelector("td:nth-child(5)")?.textContent?.toLowerCase()||"",y=a.includes(o)||c.includes(o)||l.includes(o)||i.includes(o)||d.includes(o);t.style.display=y?"":"none"})}u()}function u(){document.getElementById("search-input")?.value?.trim();const o=document.getElementById("entries-tbody"),s=document.getElementById("non-player-entries-tbody");let e=0;if(o){const a=Array.from(o.querySelectorAll("tr")).filter(c=>c.style.display!=="none");e+=a.length}if(s){const a=Array.from(s.querySelectorAll("tr")).filter(c=>c.style.display!=="none");e+=a.length}const n=document.getElementById("entry-count");n&&(n.textContent=String(e))}function g(r){const o=p(),s=o==="players"?"entries-tbody":"non-player-entries-tbody",e=document.getElementById(s);if(!e)return;const n=Array.from(e.querySelectorAll("tr")),t=o==="players"?2:1;n.sort((c,l)=>{if(r==="name-asc"){const i=(c.querySelector(`td:nth-child(${t})`)?.textContent||"").toLowerCase(),d=(l.querySelector(`td:nth-child(${t})`)?.textContent||"").toLowerCase();return i.localeCompare(d)}else if(r==="name-desc"){const i=(c.querySelector(`td:nth-child(${t})`)?.textContent||"").toLowerCase();return(l.querySelector(`td:nth-child(${t})`)?.textContent||"").toLowerCase().localeCompare(i)}else if(r==="date"){const i=new Date(c.getAttribute("data-created-at")||"").getTime();return new Date(l.getAttribute("data-created-at")||"").getTime()-i}return 0}),n.forEach(c=>e.appendChild(c));const a=document.getElementById("sort-label");a&&(r==="name-asc"?a.textContent="Name (A-Z)":r==="name-desc"?a.textContent="Name (Z-A)":r==="date"&&(a.textContent="Date")),document.querySelectorAll(".sort-option").forEach(c=>{const l=c.querySelector(".check-icon");c.getAttribute("data-sort")===r?l?.classList.remove("hidden"):l?.classList.add("hidden")})}function h(r){document.querySelectorAll(".tab-btn").forEach(a=>{a.classList.remove("bg-[#ce1141]","text-white"),a.classList.add("bg-transparent","text-[rgba(255,255,255,0.7)]")});const o=document.querySelector(`[data-tab="${r}"]`);o&&(o.classList.remove("bg-transparent","text-[rgba(255,255,255,0.7)]"),o.classList.add("bg-[#ce1141]","text-white"));const s=document.getElementById("section-title");s&&(s.textContent=r==="players"?"Player Entries":"Non-Player Entries");const e=document.getElementById("players-table-section"),n=document.getElementById("non-players-table-section");r==="players"?(e?.classList.remove("hidden"),n?.classList.add("hidden")):(e?.classList.add("hidden"),n?.classList.remove("hidden"));const t=document.getElementById("search-input");t?.value?m(t.value):u()}async function b(){try{const r=await fetch("/api/admin/entries/export");if(!r.ok)throw new Error("Failed to export players CSV");const o=await r.blob(),s=window.URL.createObjectURL(o),e=document.createElement("a");e.href=s,e.download=`players-entries-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(e),e.click(),document.body.removeChild(e),window.URL.revokeObjectURL(s),await new Promise(l=>setTimeout(l,500));const n=await fetch("/api/admin/entries/export-non-players");if(!n.ok)throw new Error("Failed to export non-players CSV");const t=await n.blob(),a=window.URL.createObjectURL(t),c=document.createElement("a");c.href=a,c.download=`non-players-entries-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(a)}catch(r){console.error("Error exporting CSVs:",r),alert("Failed to export CSVs. Please try again.")}}async function w(r,o){try{if(!(await fetch(`/api/admin/entries/${r}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({checked_in:o})})).ok)throw new Error("Failed to update check-in status");const e=document.querySelector(`tr[data-entry-id="${r}"]`);if(e){const n=e.querySelector(".check-in-checkbox"),t=e.querySelector("td:first-child span");n&&(n.checked=o),t&&(t.className=o?"inline-flex items-center justify-center w-8 h-8 rounded-full text-xs font-roboto-condensed font-bold uppercase tracking-wide bg-green-600 text-white border border-green-500":"inline-flex items-center justify-center w-8 h-8 rounded-full text-xs font-roboto-condensed font-bold uppercase tracking-wide bg-[#ce1141] text-white border border-[#b01038]",t.innerHTML=o?'<svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7" /></svg>':'<svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="9" stroke-width="2" /></svg>')}}catch(s){console.error("Error updating check-in:",s),alert("Failed to update check-in status. Please try again.")}}async function E(r,o){if(confirm(`Are you sure you want to delete the entry for ${o}?`))try{if(!(await fetch(`/api/admin/entries/${r}`,{method:"DELETE"})).ok)throw new Error("Failed to delete entry");const e=document.querySelector(`tr[data-entry-id="${r}"]`);if(e){e.remove();const n=document.querySelectorAll("#entries-tbody tr").length,t=document.getElementById("players-count");t&&(t.textContent=String(n)),u()}}catch(s){console.error("Error deleting entry:",s),alert("Failed to delete entry. Please try again.")}}async function C(r,o){if(confirm(`Are you sure you want to delete the entry for ${o}?`))try{alert("Delete functionality for non-player entries is coming soon.")}catch(s){console.error("Error deleting non-player entry:",s),alert("Failed to delete entry. Please try again.")}}async function L(){try{(await fetch("/api/logout",{method:"POST"})).ok?window.location.href="/login":console.error("Logout failed")}catch(r){console.error("Logout error:",r)}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".tab-btn").forEach(e=>{e.addEventListener("click",()=>{const n=e.getAttribute("data-tab");n&&h(n)})}),h("players"),document.getElementById("search-input")?.addEventListener("input",e=>{const n=e.target.value;m(n)});const o=document.getElementById("sort-btn"),s=document.getElementById("sort-dropdown");o?.addEventListener("click",e=>{e.stopPropagation(),s?.classList.toggle("hidden")}),document.addEventListener("click",()=>{s?.classList.add("hidden")}),s?.addEventListener("click",e=>{e.stopPropagation()}),document.querySelectorAll(".sort-option").forEach(e=>{e.addEventListener("click",()=>{const n=e.getAttribute("data-sort");n&&(g(n),s?.classList.add("hidden"))})}),document.getElementById("export-csv-btn")?.addEventListener("click",b),document.getElementById("logout-btn")?.addEventListener("click",L),document.querySelectorAll(".check-in-checkbox").forEach(e=>{e.addEventListener("change",n=>{const t=n.target,a=t.getAttribute("data-entry-id");a&&w(a,t.checked)})}),document.querySelectorAll(".delete-entry-btn").forEach(e=>{e.addEventListener("click",()=>{const n=e.getAttribute("data-entry-id"),t=e.getAttribute("data-entry-name");n&&t&&E(n,t)})}),document.querySelectorAll(".delete-non-player-entry-btn").forEach(e=>{e.addEventListener("click",()=>{const n=e.getAttribute("data-entry-id"),t=e.getAttribute("data-entry-name");n&&t&&C(n,t)})})});
