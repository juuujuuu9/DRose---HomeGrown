document.querySelectorAll(".size-button").forEach(b=>{b.addEventListener("click",function(){const o=this.getAttribute("data-size-field"),v=this.getAttribute("data-size-value");if(!o||!v)return;let g=document.getElementById(o);if(g||(g=document.getElementById(`${o}_mobile`)),!g)return;g.value=v,document.querySelectorAll(`[data-size-field="${o}"]`).forEach(f=>{const y=f===this,l=f,a=l.querySelector("p");y?(l.classList.remove("bg-[#212121]","border-[rgba(255,255,255,0.5)]"),l.classList.add("bg-white","border-[#212121]"),a&&(a.classList.remove("text-[rgba(255,255,255,0.5)]"),a.classList.add("text-[#212121]"))):(l.classList.remove("bg-white","border-[#212121]"),l.classList.add("bg-[#212121]","border-[rgba(255,255,255,0.5)]"),a&&(a.classList.remove("text-[#212121]"),a.classList.add("text-[rgba(255,255,255,0.5)]")))})})});document.getElementById("registration-form")?.addEventListener("submit",async b=>{b.preventDefault();const o=b.target;o.querySelectorAll("input[required], select[required]").forEach(e=>{const s=e,t=window.getComputedStyle(s);(t.display==="none"||t.visibility==="hidden"||s.classList.contains("hidden"))&&s.removeAttribute("required")}),o.querySelectorAll("input[required], select[required]").forEach(e=>{const s=e;let t=s.parentElement,n=!1;for(;t&&t!==o;){if(window.getComputedStyle(t).display==="none"||t.classList.contains("hidden")){n=!0;break}t=t.parentElement}n&&s.removeAttribute("required")});const d=new FormData(o),f=document.getElementById("email"),y=document.getElementById("email_desktop"),l=document.getElementById("phone"),a=document.getElementById("phone_desktop");if(f&&y){const e=f.value||y.value;f.value=e,y.value=e}if(l&&a){const e=l.value||a.value;l.value=e,a.value=e}["top_size","bottom_size","jacket_size","tight_size","shoe_size"].forEach(e=>{const s=document.getElementById(e),t=document.getElementById(`${e}_mobile`);let n="";s&&t?(n=s.value||t.value,s.value=n,t.value=n):s?(n=s.value,t&&!n&&(n=t.value,s.value=n)):t&&(n=t.value),n&&d.set(e,n)});const u={};for(const[e,s]of d.entries()){if(e==="first_name"||e==="last_name"||e==="alternative_contact_first_name"||e==="alternative_contact_last_name")continue;const t=s.toString().trim();t&&(u[e]=t)}const _=d.get("first_name")?.toString()?.trim()||"",S=d.get("last_name")?.toString()?.trim()||"";u.name=`${_} ${S}`.trim();const E=d.get("alternative_contact_first_name")?.toString()?.trim()||"",L=d.get("alternative_contact_last_name")?.toString()?.trim()||"";u.alternative_contact_name=`${E} ${L}`.trim(),console.log("Form data being sent:",u);const r=document.getElementById("registration-error"),i=document.getElementById("submit-button-wrapper"),c=i?.querySelector("span");r&&(r.textContent="",r.classList.add("hidden"));let m=null,p=!1;if(i){if(i.disabled||i.getAttribute("aria-busy")==="true")return;i.disabled=!0,i.setAttribute("aria-busy","true"),i.style.opacity="0.6",i.style.cursor="not-allowed",p=!0,c&&(m=c.innerHTML,c.innerHTML="SUBMITTING...")}const h=["name","email","phone","alternative_contact_name","alternative_contact_phone","alternative_contact_email","address","top_size","bottom_size","jacket_size","tight_size","shoe_size"].filter(e=>!u[e]||u[e].trim()==="");if(h.length>0){console.error("Missing required fields:",h),i&&p&&(i.disabled=!1,i.removeAttribute("aria-busy"),i.style.opacity="1",i.style.cursor="pointer",c&&m!==null&&(c.innerHTML=m)),r&&(r.textContent=`Please fill in all required fields. Missing: ${h.join(", ")}`,r.classList.remove("hidden"));return}try{const e=await fetch("/api/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(e.ok)window.location.href="/players/success";else{const s=await e.json().catch(()=>({}));if(console.error("Server error:",s),r){let t="Something went wrong. Please try again.";s.missing&&Array.isArray(s.missing)?t=`Please fill in all required fields. Missing: ${s.missing.join(", ")}`:s.error&&(t=s.error),r.textContent=t,r.classList.remove("hidden")}i&&p&&(i.disabled=!1,i.removeAttribute("aria-busy"),i.style.opacity="1",i.style.cursor="pointer",c&&m!==null&&(c.innerHTML=m))}}catch(e){console.error("Form submission error:",e),r&&(r.textContent="Something went wrong. Please try again.",r.classList.remove("hidden")),i&&p&&(i.disabled=!1,i.removeAttribute("aria-busy"),i.style.opacity="1",i.style.cursor="pointer",c&&m!==null&&(c.innerHTML=m))}});
