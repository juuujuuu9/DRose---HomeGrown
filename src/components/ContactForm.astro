---
// Registration form component
const shoeSizes = Array.from({ length: 11 }, (_, i) => (i + 5).toString());
const sizeOptions = ['XS', 'S', 'M', 'L', 'XL', 'XXL'];
---

<form id="registration-form" class="w-full">
  <!-- Player Section -->
  <div class="flex flex-col gap-[8px] items-start w-full">
    <p class="font-roboto-condensed font-bold leading-normal relative shrink-0 text-[12px] text-white uppercase w-full whitespace-pre-wrap">
      Player
    </p>
    
    <!-- First Name and Last Name Row -->
    <div class="flex flex-col items-start w-full">
      <div class="flex gap-[10px] items-start w-full">
        <div class="bg-[#212121] border border-[rgba(255,255,255,0.5)] border-solid flex flex-1 flex-col items-center min-h-0 overflow-clip px-4 md:px-[16px] py-3 md:py-[12px] rounded-[4px]">
          <input
            type="text"
            id="first_name"
            name="first_name"
            required
            class="w-full bg-transparent border-0 outline-0 font-roboto-condensed font-normal leading-normal text-[15px] text-white placeholder:text-[rgba(255,255,255,0.5)]"
            placeholder="First Name"
          />
        </div>
        <div class="bg-[#212121] border border-[rgba(255,255,255,0.5)] border-solid flex flex-1 flex-col items-center min-h-0 overflow-clip px-4 md:px-[16px] py-3 md:py-[12px] rounded-[4px]">
          <input
            type="text"
            id="last_name"
            name="last_name"
            required
            class="w-full bg-transparent border-0 outline-0 font-roboto-condensed font-normal leading-normal text-[15px] text-white placeholder:text-[rgba(255,255,255,0.5)]"
            placeholder="Last Name"
          />
        </div>
      </div>
    </div>
    
    <!-- Email Full Width (Mobile) -->
    <div class="md:hidden bg-[#212121] border border-[rgba(255,255,255,0.5)] border-solid flex flex-col items-center overflow-clip px-4 py-3 rounded-[4px] w-full">
      <input
        type="email"
        id="email"
        name="email"
        required
        class="w-full bg-transparent border-0 outline-0 font-roboto-condensed font-normal leading-normal text-[15px] text-white placeholder:text-[rgba(255,255,255,0.5)]"
        placeholder="Email"
      />
    </div>
    
    <!-- Email and Phone Number Row (Desktop) -->
    <div class="hidden md:flex flex-col items-start w-full">
      <div class="flex gap-[10px] items-start w-full">
        <div class="bg-[#212121] border border-[rgba(255,255,255,0.5)] border-solid flex flex-1 flex-col items-center min-h-0 overflow-clip px-[16px] py-[12px] rounded-[4px]">
          <input
            type="email"
            id="email_desktop"
            name="email"
            required
            class="w-full bg-transparent border-0 outline-0 font-roboto-condensed font-normal leading-normal text-[15px] text-white placeholder:text-[rgba(255,255,255,0.5)]"
            placeholder="Email"
          />
        </div>
        <div class="bg-[#212121] border border-[rgba(255,255,255,0.5)] border-solid flex flex-1 flex-col items-center min-h-0 overflow-clip px-[16px] py-[12px] rounded-[4px]">
          <input
            type="tel"
            id="phone_desktop"
            name="phone"
            required
            class="w-full bg-transparent border-0 outline-0 font-roboto-condensed font-normal leading-normal text-[15px] text-white placeholder:text-[rgba(255,255,255,0.5)]"
            placeholder="Phone Number"
          />
        </div>
      </div>
    </div>
    
    <!-- Phone Number Full Width (Mobile) -->
    <div class="md:hidden bg-[#212121] border border-[rgba(255,255,255,0.5)] border-solid flex flex-col items-center overflow-clip px-4 py-3 rounded-[4px] w-full">
      <input
        type="tel"
        id="phone"
        name="phone"
        required
        class="w-full bg-transparent border-0 outline-0 font-roboto-condensed font-normal leading-normal text-[15px] text-white placeholder:text-[rgba(255,255,255,0.5)]"
        placeholder="Phone Number"
      />
    </div>
    
    <!-- Address Full Width -->
    <div class="bg-[#212121] border border-[rgba(255,255,255,0.5)] border-solid flex flex-col items-center overflow-clip px-4 md:px-[16px] py-3 md:py-[12px] rounded-[4px] w-full">
      <input
        type="text"
        id="address"
        name="address"
        required
        class="w-full bg-transparent border-0 outline-0 font-roboto-condensed font-normal leading-normal text-[15px] text-white placeholder:text-[rgba(255,255,255,0.5)]"
        placeholder="Address"
      />
    </div>
  </div>

  <!-- Divider -->
  <div class="bg-[rgba(255,255,255,0.5)] h-px shrink-0 w-full my-3"></div>

  <!-- Alternative Contact Section -->
  <div class="flex flex-col gap-[8px] items-start overflow-clip w-full">
    <p class="font-roboto-condensed font-bold leading-normal relative shrink-0 text-[12px] text-white uppercase w-full whitespace-pre-wrap">
      Alternative Contact
    </p>
    
    <!-- First Name and Last Name Row -->
    <div class="flex gap-[10px] items-start w-full">
      <div class="bg-[#212121] border border-[rgba(255,255,255,0.5)] border-solid flex flex-1 flex-col items-center min-h-0 overflow-clip px-4 md:px-[16px] py-3 md:py-[12px] rounded-[4px]">
        <input
          type="text"
          id="alternative_contact_first_name"
          name="alternative_contact_first_name"
          required
          class="w-full bg-transparent border-0 outline-0 font-roboto-condensed font-normal leading-normal text-[15px] text-white placeholder:text-[rgba(255,255,255,0.5)]"
          placeholder="First Name"
        />
      </div>
      <div class="bg-[#212121] border border-[rgba(255,255,255,0.5)] border-solid flex flex-1 flex-col items-center min-h-0 overflow-clip px-4 md:px-[16px] py-3 md:py-[12px] rounded-[4px]">
        <input
          type="text"
          id="alternative_contact_last_name"
          name="alternative_contact_last_name"
          required
          class="w-full bg-transparent border-0 outline-0 font-roboto-condensed font-normal leading-normal text-[15px] text-white placeholder:text-[rgba(255,255,255,0.5)]"
          placeholder="Last Name"
        />
      </div>
    </div>
    
    <!-- Phone Number Full Width -->
    <div class="bg-[#212121] border border-[rgba(255,255,255,0.5)] border-solid flex flex-col items-center overflow-clip px-4 md:px-[16px] py-3 md:py-[12px] rounded-[4px] w-full">
      <input
        type="tel"
        id="alternative_contact_phone"
        name="alternative_contact_phone"
        required
        class="w-full bg-transparent border-0 outline-0 font-roboto-condensed font-normal leading-normal text-[15px] text-white placeholder:text-[rgba(255,255,255,0.5)]"
        placeholder="Phone Number"
      />
    </div>
    
    <!-- Email Full Width (required for API but not shown in Figma design - keeping visible) -->
    <div class="bg-[#212121] border border-[rgba(255,255,255,0.5)] border-solid flex flex-col items-center overflow-clip px-4 md:px-[16px] py-3 md:py-[12px] rounded-[4px] w-full">
      <input
        type="email"
        id="alternative_contact_email"
        name="alternative_contact_email"
        required
        class="w-full bg-transparent border-0 outline-0 font-roboto-condensed font-normal leading-normal text-[15px] text-white placeholder:text-[rgba(255,255,255,0.5)]"
        placeholder="Email"
      />
    </div>
  </div>

  <!-- Divider -->
  <div class="bg-[rgba(255,255,255,0.5)] h-px shrink-0 w-full my-3"></div>

  <!-- Size Selection: Desktop Dropdowns / Mobile Button Grids -->
  <div class="flex flex-col gap-3 w-full">
    <!-- Top Size -->
    <div class="flex flex-col gap-2 items-start w-full">
      <!-- Desktop Dropdown (no label) -->
      <div class="hidden md:flex bg-[#212121] border border-[rgba(255,255,255,0.5)] border-solid items-start justify-between overflow-clip px-[16px] py-[12px] rounded-[4px] w-full">
        <select
          id="top_size"
          name="top_size"
          required
          class="flex-1 min-h-0 bg-transparent border-0 outline-0 font-roboto-condensed font-normal leading-normal text-[15px] text-[rgba(255,255,255,0.5)] appearance-none cursor-pointer"
        >
          <option value="" class="bg-[#212121] text-[rgba(255,255,255,0.5)]">Top Size</option>
          {sizeOptions.map(size => (
            <option value={size} class="bg-[#212121] text-white">{size}</option>
          ))}
        </select>
        <svg class="w-4 h-4 text-white shrink-0 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </div>
      <!-- Mobile Button Grid -->
      <div class="md:hidden flex flex-col gap-2 items-start w-full">
        <p class="font-roboto-condensed font-bold leading-normal relative shrink-0 text-[12px] text-white uppercase w-full whitespace-pre-wrap">
          Top Size
        </p>
        <div class="flex gap-1 items-start w-full">
          {sizeOptions.map(size => (
            <button
              type="button"
              data-size-field="top_size"
              data-size-value={size}
              class="size-button bg-[#212121] border border-[rgba(255,255,255,0.5)] border-solid flex flex-col items-center justify-center overflow-clip rounded-[4px] shrink-0 w-[42px] h-[42px] cursor-pointer"
            >
              <p class="font-roboto-condensed font-normal leading-normal text-[15px] text-[rgba(255,255,255,0.5)] text-center">
                {size}
              </p>
            </button>
          ))}
        </div>
        <select id="top_size" name="top_size" required class="hidden">
          <option value=""></option>
          {sizeOptions.map(size => (
            <option value={size}>{size}</option>
          ))}
        </select>
      </div>
    </div>

    <!-- Bottom Size -->
    <div class="flex flex-col gap-2 items-start w-full">
      <!-- Desktop Dropdown (no label) -->
      <div class="hidden md:flex bg-[#212121] border border-[rgba(255,255,255,0.5)] border-solid items-start justify-between overflow-clip px-[16px] py-[12px] rounded-[4px] w-full">
        <select
          id="bottom_size"
          name="bottom_size"
          required
          class="flex-1 min-h-0 bg-transparent border-0 outline-0 font-roboto-condensed font-normal leading-normal text-[15px] text-[rgba(255,255,255,0.5)] appearance-none cursor-pointer"
        >
          <option value="" class="bg-[#212121] text-[rgba(255,255,255,0.5)]">Bottom Size</option>
          {sizeOptions.map(size => (
            <option value={size} class="bg-[#212121] text-white">{size}</option>
          ))}
        </select>
        <svg class="w-4 h-4 text-white shrink-0 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </div>
      <!-- Mobile Button Grid -->
      <div class="md:hidden flex flex-col gap-2 items-start w-full">
        <p class="font-roboto-condensed font-bold leading-normal relative shrink-0 text-[12px] text-white uppercase w-full whitespace-pre-wrap">
          Bottom Size
        </p>
        <div class="flex gap-1 items-start w-full">
          {sizeOptions.map(size => (
            <button
              type="button"
              data-size-field="bottom_size"
              data-size-value={size}
              class="size-button bg-[#212121] border border-[rgba(255,255,255,0.5)] border-solid flex flex-col items-center justify-center overflow-clip rounded-[4px] shrink-0 w-[42px] h-[42px] cursor-pointer"
            >
              <p class="font-roboto-condensed font-normal leading-normal text-[15px] text-[rgba(255,255,255,0.5)] text-center">
                {size}
              </p>
            </button>
          ))}
        </div>
        <select id="bottom_size" name="bottom_size" required class="hidden">
          <option value=""></option>
          {sizeOptions.map(size => (
            <option value={size}>{size}</option>
          ))}
        </select>
      </div>
    </div>

    <!-- Jacket/Hoodie Size -->
    <div class="flex flex-col gap-2 items-start w-full">
      <!-- Desktop Dropdown (no label) -->
      <div class="hidden md:flex bg-[#212121] border border-[rgba(255,255,255,0.5)] border-solid items-start justify-between overflow-clip px-[16px] py-[12px] rounded-[4px] w-full">
        <select
          id="jacket_size"
          name="jacket_size"
          required
          class="flex-1 min-h-0 bg-transparent border-0 outline-0 font-roboto-condensed font-normal leading-normal text-[15px] text-[rgba(255,255,255,0.5)] appearance-none cursor-pointer"
        >
          <option value="" class="bg-[#212121] text-[rgba(255,255,255,0.5)]">Jacket/Hoodie Size</option>
          {sizeOptions.map(size => (
            <option value={size} class="bg-[#212121] text-white">{size}</option>
          ))}
        </select>
        <svg class="w-4 h-4 text-white shrink-0 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </div>
      <!-- Mobile Button Grid -->
      <div class="md:hidden flex flex-col gap-2 items-start w-full">
        <p class="font-roboto-condensed font-bold leading-normal relative shrink-0 text-[12px] text-white uppercase w-full whitespace-pre-wrap">
          Jacket/Hoodie Size
        </p>
        <div class="flex gap-1 items-start w-full">
          {sizeOptions.map(size => (
            <button
              type="button"
              data-size-field="jacket_size"
              data-size-value={size}
              class="size-button bg-[#212121] border border-[rgba(255,255,255,0.5)] border-solid flex flex-col items-center justify-center overflow-clip rounded-[4px] shrink-0 w-[42px] h-[42px] cursor-pointer"
            >
              <p class="font-roboto-condensed font-normal leading-normal text-[15px] text-[rgba(255,255,255,0.5)] text-center">
                {size}
              </p>
            </button>
          ))}
        </div>
        <select id="jacket_size" name="jacket_size" required class="hidden">
          <option value=""></option>
          {sizeOptions.map(size => (
            <option value={size}>{size}</option>
          ))}
        </select>
      </div>
    </div>

    <!-- Tight Size -->
    <div class="flex flex-col gap-2 items-start w-full">
      <!-- Desktop Dropdown (no label) -->
      <div class="hidden md:flex bg-[#212121] border border-[rgba(255,255,255,0.5)] border-solid items-start justify-between overflow-clip px-[16px] py-[12px] rounded-[4px] w-full">
        <select
          id="tight_size"
          name="tight_size"
          required
          class="flex-1 min-h-0 bg-transparent border-0 outline-0 font-roboto-condensed font-normal leading-normal text-[15px] text-[rgba(255,255,255,0.5)] appearance-none cursor-pointer"
        >
          <option value="" class="bg-[#212121] text-[rgba(255,255,255,0.5)]">Tight Size</option>
          {sizeOptions.map(size => (
            <option value={size} class="bg-[#212121] text-white">{size}</option>
          ))}
        </select>
        <svg class="w-4 h-4 text-white shrink-0 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </div>
      <!-- Mobile Button Grid -->
      <div class="md:hidden flex flex-col gap-2 items-start w-full">
        <p class="font-roboto-condensed font-bold leading-normal relative shrink-0 text-[12px] text-white uppercase w-full whitespace-pre-wrap">
          Tight Size
        </p>
        <div class="flex gap-1 items-start w-full">
          {sizeOptions.map(size => (
            <button
              type="button"
              data-size-field="tight_size"
              data-size-value={size}
              class="size-button bg-[#212121] border border-[rgba(255,255,255,0.5)] border-solid flex flex-col items-center justify-center overflow-clip rounded-[4px] shrink-0 w-[42px] h-[42px] cursor-pointer"
            >
              <p class="font-roboto-condensed font-normal leading-normal text-[15px] text-[rgba(255,255,255,0.5)] text-center">
                {size}
              </p>
            </button>
          ))}
        </div>
        <select id="tight_size" name="tight_size" required class="hidden">
          <option value=""></option>
          {sizeOptions.map(size => (
            <option value={size}>{size}</option>
          ))}
        </select>
      </div>
    </div>

    <!-- Shoe Size -->
    <div class="flex flex-col gap-2 items-start w-full">
      <!-- Desktop Dropdown (no label) -->
      <div class="hidden md:flex bg-[#212121] border border-[rgba(255,255,255,0.5)] border-solid items-start justify-between overflow-clip px-[16px] py-[12px] rounded-[4px] w-full">
        <select
          id="shoe_size"
          name="shoe_size"
          required
          class="flex-1 min-h-0 bg-transparent border-0 outline-0 font-roboto-condensed font-normal leading-normal text-[15px] text-[rgba(255,255,255,0.5)] appearance-none cursor-pointer"
        >
          <option value="" class="bg-[#212121] text-[rgba(255,255,255,0.5)]">Shoe Size</option>
          {shoeSizes.map(size => (
            <option value={size} class="bg-[#212121] text-white">{size}</option>
          ))}
        </select>
        <svg class="w-4 h-4 text-white shrink-0 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </div>
      <!-- Mobile Button Grid (7 columns x 2 rows) -->
      <div class="md:hidden flex flex-col gap-2 items-start w-full">
        <p class="font-roboto-condensed font-bold leading-normal relative shrink-0 text-[12px] text-white uppercase w-full whitespace-pre-wrap">
          Shoe Size
        </p>
        <div class="grid grid-cols-7 gap-1 h-[88px] w-full">
          {shoeSizes.map((size, index) => (
            <button
              type="button"
              data-size-field="shoe_size"
              data-size-value={size}
              class="size-button bg-[#212121] border border-[rgba(255,255,255,0.5)] border-solid flex flex-col items-center justify-center overflow-clip rounded-[4px] shrink-0 w-[42px] h-[42px] cursor-pointer"
            >
              <p class="font-roboto-condensed font-normal leading-normal text-[15px] text-[rgba(255,255,255,0.5)] text-center">
                {size}
              </p>
            </button>
          ))}
        </div>
        <select id="shoe_size" name="shoe_size" required class="hidden">
          <option value=""></option>
          {shoeSizes.map(size => (
            <option value={size}>{size}</option>
          ))}
        </select>
      </div>
    </div>
  </div>

  <!-- Inline error box (hidden by default) -->
  <div
    id="registration-error"
    class="hidden mt-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg text-[18px] text-center"
    aria-live="polite"
  ></div>
</form>

<script>
  // Mobile size button handler
  document.querySelectorAll('.size-button').forEach(button => {
    button.addEventListener('click', function() {
      const fieldName = this.getAttribute('data-size-field');
      const sizeValue = this.getAttribute('data-size-value');
      const selectElement = document.getElementById(fieldName) as HTMLSelectElement;
      
      if (!selectElement) return;
      
      // Update select value
      selectElement.value = sizeValue;
      
      // Update all buttons in this group
      const allButtons = document.querySelectorAll(`[data-size-field="${fieldName}"]`);
      allButtons.forEach(btn => {
        const isSelected = btn === this;
        const buttonElement = btn as HTMLButtonElement;
        const textElement = buttonElement.querySelector('p');
        
        if (isSelected) {
          // Selected: white background, dark text, dark border
          buttonElement.classList.remove('bg-[#212121]', 'border-[rgba(255,255,255,0.5)]');
          buttonElement.classList.add('bg-white', 'border-[#212121]');
          if (textElement) {
            textElement.classList.remove('text-[rgba(255,255,255,0.5)]');
            textElement.classList.add('text-[#212121]');
          }
        } else {
          // Unselected: dark background, white text, white border
          buttonElement.classList.remove('bg-white', 'border-[#212121]');
          buttonElement.classList.add('bg-[#212121]', 'border-[rgba(255,255,255,0.5)]');
          if (textElement) {
            textElement.classList.remove('text-[#212121]');
            textElement.classList.add('text-[rgba(255,255,255,0.5)]');
          }
        }
      });
    });
  });

  document.getElementById('registration-form')?.addEventListener('submit', async (e) => {
    e.preventDefault();

    const form = e.target as HTMLFormElement;
    const formData = new FormData(form);
    
    // Sync mobile/desktop email and phone fields
    const emailMobile = document.getElementById('email') as HTMLInputElement;
    const emailDesktop = document.getElementById('email_desktop') as HTMLInputElement;
    const phoneMobile = document.getElementById('phone') as HTMLInputElement;
    const phoneDesktop = document.getElementById('phone_desktop') as HTMLInputElement;
    
    if (emailMobile && emailDesktop) {
      const emailValue = emailMobile.value || emailDesktop.value;
      emailMobile.value = emailValue;
      emailDesktop.value = emailValue;
    }
    if (phoneMobile && phoneDesktop) {
      const phoneValue = phoneMobile.value || phoneDesktop.value;
      phoneMobile.value = phoneValue;
      phoneDesktop.value = phoneValue;
    }
    
    // Combine first_name and last_name into name for backend compatibility
    const data: Record<string, string> = {};
    for (const [key, value] of formData.entries()) {
      if (key === 'first_name' || key === 'last_name') {
        continue;
      }
      data[key] = value.toString();
    }
    
    // Combine names
    const firstName = formData.get('first_name')?.toString() || '';
    const lastName = formData.get('last_name')?.toString() || '';
    data.name = `${firstName} ${lastName}`.trim();
    
    // Combine alternative contact names
    const altFirstName = formData.get('alternative_contact_first_name')?.toString() || '';
    const altLastName = formData.get('alternative_contact_last_name')?.toString() || '';
    data.alternative_contact_name = `${altFirstName} ${altLastName}`.trim();

    const errorContainer = document.getElementById('registration-error');
    const submitButtonWrapper = document.getElementById('submit-button-wrapper') as HTMLButtonElement;
    const submitButton = submitButtonWrapper?.querySelector('p') as HTMLParagraphElement;

    // Clear previous error
    if (errorContainer) {
      errorContainer.textContent = '';
      errorContainer.classList.add('hidden');
    }

    // Loading state
    let originalButtonHTML = null;
    if (submitButton) {
      originalButtonHTML = submitButton.innerHTML;
      submitButton.innerHTML = 'SUBMITTING...';
      if (submitButtonWrapper) {
        submitButtonWrapper.style.opacity = '0.6';
        submitButtonWrapper.style.cursor = 'not-allowed';
        submitButtonWrapper.setAttribute('aria-busy', 'true');
      }
    }

    try {
      const response = await fetch('/api/signup', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      if (response.ok) {
        // Redirect or show success - the button wrapper will be replaced by success message
        if (submitButtonWrapper) {
          submitButtonWrapper.setAttribute('aria-live', 'polite');
          submitButtonWrapper.innerHTML = `
            <p class="font-prohibition leading-normal not-italic relative shrink-0 text-[20px] text-center text-white tracking-[4px] uppercase w-full whitespace-pre-wrap">
              SUBMITTED!
            </p>
          `;
        }
        form.reset();
        // Reset mobile size buttons
        document.querySelectorAll('.size-button').forEach(btn => {
          const buttonElement = btn as HTMLButtonElement;
          const textElement = buttonElement.querySelector('p');
          buttonElement.classList.remove('bg-white', 'border-[#212121]');
          buttonElement.classList.add('bg-[#212121]', 'border-[rgba(255,255,255,0.5)]');
          if (textElement) {
            textElement.classList.remove('text-[#212121]');
            textElement.classList.add('text-[rgba(255,255,255,0.5)]');
          }
        });
      } else {
        const errorData = await response.json().catch(() => ({}));
        console.error('Server error:', errorData);
        if (errorContainer) {
          errorContainer.textContent = 'Something went wrong. Please try again.';
          errorContainer.classList.remove('hidden');
        }
        if (submitButton && originalButtonHTML !== null) {
          submitButton.innerHTML = originalButtonHTML;
          if (submitButtonWrapper) {
            submitButtonWrapper.style.opacity = '1';
            submitButtonWrapper.style.cursor = 'pointer';
            submitButtonWrapper.removeAttribute('aria-busy');
          }
        }
      }
    } catch (error) {
      console.error('Form submission error:', error);
      if (errorContainer) {
        errorContainer.textContent = 'Something went wrong. Please try again.';
        errorContainer.classList.remove('hidden');
      }
      if (submitButton && originalButtonHTML !== null) {
        submitButton.innerHTML = originalButtonHTML;
        if (submitButtonWrapper) {
          submitButtonWrapper.style.opacity = '1';
          submitButtonWrapper.style.cursor = 'pointer';
          submitButtonWrapper.removeAttribute('aria-busy');
        }
      }
    }
  });
</script>
